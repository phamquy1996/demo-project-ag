import React, { useRef } from 'react';
import JoditEditor from "jodit-react";
import axios from 'axios';

const MyEditor = () => {
  const editor = useRef(null);
  
  const config = {
    uploader: {
      insertImageAsBase64URI: false, // Disable base64 image to handle custom uploads
      url: '/upload-image', // Set this to your server's image upload URL
      format: 'json',
      method: 'POST',
      filesVariableName: function () {
        return 'files';
      },
      process: function (resp) {
        // Assuming your response contains the uploaded image URL
        return {
          files: resp.data.fileUrl, // Adjust this according to your API response format
        };
      },
    },
    events: {
      afterPaste: function (e, editor) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let item of items) {
          if (item.type.indexOf("image") === 0) {
            const file = item.getAsFile();
            const formData = new FormData();
            formData.append('files', file);

            // Upload the image using axios or your preferred HTTP client
            axios.post('/upload-image', formData)
              .then(response => {
                const imageUrl = response.data.fileUrl; // Adjust based on response
                editor.s.insertImage(imageUrl); // Insert uploaded image URL
              })
              .catch(error => {
                console.error('Image upload failed:', error);
              });
          }
        }
      }
    }
  };

  return (
    <JoditEditor
      ref={editor}
      value="<p>Start typing...</p>"
      config={config}
    />
  );
};

export default MyEditor;
